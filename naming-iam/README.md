## Module naming-iam  


A label follows the following convention depending on the type:

__IAM Policies__  
	```{enterprise/BU}-{context (project, depts, etc)}-{PolicyName}```  
	EXAMPLE: aztec-cloudtribe-infraadmins-policy  
__IAM role__  
```{enterprise/BU}-{context (project, depts, etc)}-{RoleName}-{Function}```  
	EXAMPLE: aztec-cloudtribe-infraadmins-assumerole  
__IAM Groups__  
```{enterprise/BU}-{context (project, depts, etc)}-{GroupName}```  
	EXAMPLE: aztec-cloudtribe-infraadmins  


## Usage

### Simple Example

Include this repository as a module in your existing terraform code:

A `naming.tf` file for Modules is located in the modules directory which generates the names and tags for Resources and IAM-Resources using the same parameter.
Just copy this file into your Modules directory and use it in your module as follows 

` name = ${module.labeliam.id-policy}`  

or for Tags:

`tags = "${modules.labeliam.tags}"`


```hcl
module "labeliam" {
  source       = "../../naming-iam"
  oe           = "aztec"
  context      = "cloudtribe"
  project      = "infraadmins"
  policy       = "policy"
  role         = "assumerole"
  groupname    = "infraadmins"
  attributes = [""] //can be used to add parts to id
  tags       = "${map("cost_center", "123456789", "Debitor", "70000001")}"
}
```

This will create the following output:
```hcl

id-policy = aztec-cloudtribe-infraadmins-policy
id-role = aztec-cloudtribe-infraadmins-role
id-groupname = aztec-cloudtribe-infraadmins-groupname
oe = aztec
project = infraadmins
region = eu-central-1
role = assumerole
attributes = ""
tags = {
  Debitor = 70000001
  Environment = dev
  Name = aztec-cloudtribe-infraadmins-policy
  OE = aztec
  Project = infraadmins
  Region = eu-central-1
  Role = assumerole
  cost_center = 123456789
}
```


Now reference the label when creating an instance (for example):

```hcl
resource "aws_instance" "eg_prod_bastion_public" {
  instance_type = "t1.micro"
  tags          = "${module.label.tags}"
}
```

Or define a security group:

```hcl
resource "aws_security_group" "eg_prod_bastion_public" {
  vpc_id = "${var.vpc_id}"
  name   = "${module.label.id}"
  tags   = "${module.label.tags}"
  egress {
    from_port   = 0
    to_port     = 0
    protocol    = "-1"
    cidr_blocks = ["0.0.0.0/0"]
  }
}
```



## Input

<!--------------------------------REQUIRE POSTPROCESSING-------------------------------->
|  Name |  Default  |  Description  |
|:------|:---------:|:--------------:|
| attributes |[] |Additional attributes (e.g. `policy` or `role`) add to the 'ID'|
| delimiter |"\_" |Delimiter to be used between `name`, `namespace`, `stage`, etc.|
| enabled |"true" |Set to false to prevent the module from creating any resources|
| oe |REQUIRED |Allianz OE e.g. "azt" for AZ Technology|
| project |Optional |Project Name used to separate projects of an AZ OE|
| environment |dev |Environment, e.g. 'prod', 'test', 'dev', or 'shared'|
| service | REQUIRED | AWS service, e.g 'sg' for security group or 'elb' for elastic load balancer |
| role | REQUIRED | Role or Scope of the Service, e.g. 'ldap' or application name like 'jenkins' |
| ext | Optional | extension to the full name, e.g. Sequenze or additional name |
| tags |{} |Additional tags (e.g. `map('BusinessUnit`,`XYZ`)|

**WARNING** Any tags passed as an input to this module will *override* the tags generated by this module.

## Output

<!--------------------------------REQUIRE POSTPROCESSING-------------------------------->
|  Name | Description  |
|:------|:------------:|
| attributes | Normalized attributes  |
| id | Disambiguated ID  |
| environment | Normalized environment  |
| oe | Normalized Allianz OE  |
| project | Normalized project  |
| region | Normalized region |
| role | Normalized Role or Scope |
| service | Normalized Service |
| tags | Merge input tags with our tags. Note: `Name` has a special meaning in AWS and we need to disamgiuate it by using the computed `id`   |

